<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dockerfile | 前端学习</title>
    <meta name="description" content="个人前端知识的学习、积累和总结">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/mybase/assets/css/0.styles.6a1e607d.css" as="style"><link rel="preload" href="/mybase/assets/js/app.9ed2f987.js" as="script"><link rel="preload" href="/mybase/assets/js/2.24c8d6a2.js" as="script"><link rel="preload" href="/mybase/assets/js/12.54061730.js" as="script"><link rel="prefetch" href="/mybase/assets/js/10.332a6443.js"><link rel="prefetch" href="/mybase/assets/js/11.f5a66f2a.js"><link rel="prefetch" href="/mybase/assets/js/13.ed8d2dee.js"><link rel="prefetch" href="/mybase/assets/js/14.9e177830.js"><link rel="prefetch" href="/mybase/assets/js/15.68a37b89.js"><link rel="prefetch" href="/mybase/assets/js/16.0c52745a.js"><link rel="prefetch" href="/mybase/assets/js/3.10af510b.js"><link rel="prefetch" href="/mybase/assets/js/4.0394e7c9.js"><link rel="prefetch" href="/mybase/assets/js/5.b5b11767.js"><link rel="prefetch" href="/mybase/assets/js/6.c18c11ea.js"><link rel="prefetch" href="/mybase/assets/js/7.3544361c.js"><link rel="prefetch" href="/mybase/assets/js/8.374f18ea.js"><link rel="prefetch" href="/mybase/assets/js/9.6dae1890.js">
    <link rel="stylesheet" href="/mybase/assets/css/0.styles.6a1e607d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mybase/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mybase/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/mybase/docker/" class="nav-link router-link-active">
  Docker
</a></div> <a href="https://github.com/rickychoi1994/mybase" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mybase/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/mybase/docker/" class="nav-link router-link-active">
  Docker
</a></div> <a href="https://github.com/rickychoi1994/mybase" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/mybase/docker/" class="sidebar-link">初识 Docker</a></li><li><a href="/mybase/docker/options.html" class="sidebar-link">镜像加速</a></li><li><a href="/mybase/docker/command.html" class="sidebar-link">Docker 命令</a></li><li><a href="/mybase/docker/data.html" class="sidebar-link">数据卷</a></li><li><a href="/mybase/docker/deploy.html" class="sidebar-link">应用部署</a></li><li><a href="/mybase/docker/dockerfile.html" class="active sidebar-link">Dockerfile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mybase/docker/dockerfile.html#docker镜像原理" class="sidebar-link">docker镜像原理</a></li><li class="sidebar-sub-header"><a href="/mybase/docker/dockerfile.html#镜像制作" class="sidebar-link">镜像制作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mybase/docker/dockerfile.html#容器转为镜像" class="sidebar-link">容器转为镜像</a></li><li class="sidebar-sub-header"><a href="/mybase/docker/dockerfile.html#dockerfile-2" class="sidebar-link">Dockerfile</a></li></ul></li></ul></li><li><a href="/mybase/docker/docker_compose.html" class="sidebar-link">Docker Compose</a></li><li><a href="/mybase/docker/private_store.html" class="sidebar-link">私有仓库</a></li><li><a href="/mybase/docker/compare.html" class="sidebar-link">与传统虚拟机的比较</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h1> <h2 id="docker镜像原理"><a href="#docker镜像原理" class="header-anchor">#</a> docker镜像原理</h2> <div class="custom-block warning"><p class="custom-block-title">思考</p> <ul><li>Docker镜像本质是什么？</li> <li>Docker中一个centos镜像为什么只有200MB，而一个centos操作系统的iso文件要几个G？</li> <li>Docker中一个tomcat镜像为什么有500MB，而一个tomcat安装包只有70多MB？</li></ul></div> <div class="custom-block tip"><p class="custom-block-title">Linux</p> <p>Linux文件系统由<code>bootfs</code>和<code>rootfs</code>两部分组成</p> <ul><li>bootfs：包含<code>bootloader(引导加载程序)</code>和<code>kernel(内核)</code></li> <li>rootfs：root文件系统，包含的就是典型的Linux系统中的/dev，/proc，/bin，/etc等标准目录和文件</li> <li>不同的linux发行版，bootfs基本一样，而rootfs不同，如：ubuntu，centos等</li></ul></div> <ul><li>Docker镜像是由特殊的文件系统叠加而成</li> <li>最底端的是bootfs，并使用宿主机的bootfs</li> <li>第二层是root文件系统rootfs，称为base image</li> <li>然后在往上可以叠加其他的镜像文件</li> <li>统一文件系统(Union File System)技术能够将不同的层整合称一个文件系统，为这些层提供了一个统一的视角，这样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统</li> <li>一个镜像可以放在另一个镜像的上面。位于下面的镜像称为父镜像，最底部的镜像称为基础镜像</li> <li>当一个镜像启动容器时，Docker会在最顶层加载一个读写文件系统作为容器</li></ul> <img src="/mybase/docker-image.png"> <div class="custom-block tip"><p class="custom-block-title">解答</p> <ul><li>Docker镜像本质是什么？
<ul><li>是一个分层文件系统</li></ul></li> <li>Docker中一个centos镜像为什么只有200MB，而一个centos操作系统的iso文件要几个G？
<ul><li>Centos的iso镜像文件包含bootfs和rootfs，而docker的centos镜像复用操作系统的bootfs，只有rootfs和其他镜像层</li></ul></li> <li>Docker中一个tomcat镜像为什么有500MB，而一个tomcat安装包只有70多MB？
<ul><li>由于docker中镜像是分层的，tomcat虽然只有70+MB，但它需要依赖于父镜像和基础镜像，所以整个对外暴露的tomcat镜像大小500+MB</li></ul></li></ul></div> <h2 id="镜像制作"><a href="#镜像制作" class="header-anchor">#</a> 镜像制作</h2> <p>Docker镜像如何制作？</p> <h3 id="容器转为镜像"><a href="#容器转为镜像" class="header-anchor">#</a> 容器转为镜像</h3> <ul><li><code>docker commit 容器id 镜像名称:版本号</code></li> <li><code>docker save -o 压缩文件名称 镜像名称:版本号</code></li> <li><code>docker load -i 压缩文件名称</code></li></ul> <img src="/mybase/docker-image2.png"> <h3 id="dockerfile-2"><a href="#dockerfile-2" class="header-anchor">#</a> Dockerfile</h3> <ul><li>Dockerfile是一个文本文件</li> <li>包含了一条条指令</li> <li>每一条指令构建一层，基于基础镜像，最终构建出一个新的镜像</li> <li>对于开发人员：可以为开发团队提供一个完全一致的开发环境</li> <li>对于测试人员：可以直接拿开发时所构建的镜像或者通过Dockerfile文件构建一个新的镜像开始工作了</li> <li>对于运维人员：在部署时，可以实现应用的无缝移植</li></ul> <table><thead><tr><th>关键字</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>FROM</td> <td>指定父镜像</td> <td>指定dockerfile基于那个image构建</td></tr> <tr><td>MAINTAINER</td> <td>作者信息</td> <td>用来标明这个dockerfile谁写的</td></tr> <tr><td>LABEL</td> <td>标签</td> <td>用来标明dockerfile的标签 可以使用Label代替Maintainer 最终都是在docker image基本信息中可以查看</td></tr> <tr><td>RUN</td> <td>执行命令</td> <td>执行一段命令 默认是/bin/sh 格式: RUN command 或者 RUN [&quot;command&quot; , &quot;param1&quot;,&quot;param2&quot;]</td></tr> <tr><td>CMD</td> <td>容器启动命令</td> <td>提供启动容器时候的默认命令 和ENTRYPOINT配合使用.格式 CMD command param1 param2 或者 CMD [&quot;command&quot; , &quot;param1&quot;,&quot;param2&quot;]</td></tr> <tr><td>ENTRYPOINT</td> <td>入口</td> <td>一般在制作一些执行就关闭的容器中会使用</td></tr> <tr><td>COPY</td> <td>复制文件</td> <td>build的时候复制文件到image中</td></tr> <tr><td>ADD</td> <td>添加文件</td> <td>build的时候添加文件到image中 不仅仅局限于当前build上下文 可以来源于远程服务</td></tr> <tr><td>ENV</td> <td>环境变量</td> <td>指定build时候的环境变量 可以在启动的容器的时候 通过-e覆盖 格式ENV name=value</td></tr> <tr><td>ARG</td> <td>构建参数</td> <td>构建参数 只在构建的时候使用的参数 如果有ENV 那么ENV的相同名字的值始终覆盖arg的参数</td></tr> <tr><td>VOLUME</td> <td>定义外部可以挂载的数据卷</td> <td>指定build的image那些目录可以启动的时候挂载到文件系统中 启动容器的时候使用 -v 绑定 格式 VOLUME [&quot;目录&quot;]</td></tr> <tr><td>EXPOSE</td> <td>暴露端口</td> <td>定义容器运行的时候监听的端口 启动容器的使用-p来绑定暴露端口 格式: EXPOSE 8080 或者 EXPOSE 8080/udp</td></tr> <tr><td>WORKDIR</td> <td>工作目录</td> <td>指定容器内部的工作目录 如果没有创建则自动创建 如果指定/ 使用的是绝对地址 如果不是/开头那么是在上一条workdir的路径的相对路径</td></tr> <tr><td>USER</td> <td>指定执行用户</td> <td>指定build或者启动的时候 用户 在RUN CMD ENTRYPONT执行的时候的用户</td></tr> <tr><td>HEALTHCHECK</td> <td>健康检查</td> <td>指定监测当前容器的健康监测的命令 基本上没用 因为很多时候 应用本身有健康监测机制</td></tr> <tr><td>ONBUILD</td> <td>触发器</td> <td>当存在ONBUILD关键字的镜像作为基础镜像的时候 当执行FROM完成之后 会执行 ONBUILD的命令 但是不影响当前镜像 用处也不怎么大</td></tr> <tr><td>STOPSIGNAL</td> <td>发送信号量到宿主机</td> <td>该STOPSIGNAL指令设置将发送到容器的系统调用信号以退出。</td></tr> <tr><td>SHELL</td> <td>指定执行脚本的shell</td> <td>指定RUN CMD ENTRYPOINT 执行命令的时候 使用的shell</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近一次更新时间:</span> <span class="time">4/7/2020, 5:53:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mybase/docker/deploy.html" class="prev">
        应用部署
      </a></span> <span class="next"><a href="/mybase/docker/docker_compose.html">
        Docker Compose
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/mybase/assets/js/app.9ed2f987.js" defer></script><script src="/mybase/assets/js/2.24c8d6a2.js" defer></script><script src="/mybase/assets/js/12.54061730.js" defer></script>
  </body>
</html>
