# 数据卷

::: warning 思考
- Docker 容器删除后，在容器中产生的数据还在吗？
- Docker 容器和外部机器可以直接交换文件吗？
- 容器之间如何进行数据交互？
:::


## 概念

- 数据卷是宿主机终端俄一个目录或文件
- 当容器目录和数据卷目录绑定后，对方的修改会立即同步
- 一个数据卷可以被多个容器同时挂载
- 一个容器也可以挂载多个数据卷


## 作用

- 容器数据持久化
- 外部机器和容器间接通信
- 容器之间的数据交换


## 配置

```bash
# 创建启动容器时，使用-v参数设置数据卷
docker run ... -v 宿主机目录(文件):容器内目录(文件)...

# 注意事项:
#    1. 目录必须是绝对路径
#    2. 如果目录不存在，自动创建
#    3. 可以挂载多个数据卷
```


## 数据卷容器

多容器进行数据交换:
- 多个容器挂载同一个数据卷 (容器多的话操作麻烦，对于数据的保存持久化和恢复不方便)
- **数据卷容器**

![数据卷](/data.png)

创建一个容器`c3`并挂载宿主机的一个数据卷，之后把`c1`和`c2`挂载到`c3`上，相当于`c1`、`c2`和`c3`都挂载到了同一个数据卷上，这就意味着`c1`、`c2`、`c3`可以相互的数据传输和通讯，即使`c3`出现了问题，`c1`和`c2`依然可以通过宿主机的数据卷进行通讯。`c3`就被成为数据卷容器。

```bash
# 创建启动c3数据卷容器，使用-v参数设置数据卷
docker run -it --name c3 -v /volume ...

# 注意
# 上面命令的 /volume 是容器目录，并不是宿主机数据卷目录，但是宿主机会自动分配一个目录当作数据卷

# 创建启动c1、c2容器，使用--volumes-from参数设置数据卷
docker run -it --name c1 --volumes-from c3 ...
docker run -it --name c2 --volumes-from c3 ...
```
